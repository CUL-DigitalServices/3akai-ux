<!-- CSS -->
<link rel="stylesheet" type="text/css" href="css/activity.css" />

<div class="activity-widget">
    <div class="oae-list-options">
        <div>
            <button class="btn oae-list-options-toggle">
                <h2>__MSG__RECENT_ACTIVITY__</h2>
            </button>
        </div>
    </div>
    <ul class="oae-list"><!----></ul>
</div>

<div id="activity-noresults-template"><!--
    <div class="alert">
        <span>__MSG__NO_ACTIVITIES_OCCURRED_YET__</span>
    </div>
--></div>

<div id="activity-items-template"><!--
    {macro renderSummary(activity, renderTargetThumbnail)}
        {if activity.actor['oae:collection']}
            {var actor1Obj = activity.actor['oae:collection'][0]}
            {if activity.actor['oae:collection'].length > 1}
                {var actorCount = activity.actor['oae:collection'].length}
                {var actor2 = oae.api.util.security().encodeForHTML(activity.actor['oae:collection'][1].displayName)}
                {var actor2URL = oae.api.util.security().encodeForHTML(activity.actor['oae:collection'][1]['oae:profilePath'])}
            {/if}
        {else}
            {var actor1Obj = activity.actor}
        {/if}
        {var actor1 = oae.api.util.security().encodeForHTML(actor1Obj.displayName)}
        {var actor1URL = oae.api.util.security().encodeForHTML(actor1Obj['oae:profilePath'])}

        {if activity.object['oae:collection']}
            {var object1Obj = activity.object['oae:collection'][0]}
            {if activity.object['oae:collection'].length > 1}
                {var objectCount = activity.object['oae:collection'].length}
                {var object2 = oae.api.util.security().encodeForHTML(activity.object['oae:collection'][1].displayName)}
                {var object2URL = oae.api.util.security().encodeForHTML(activity.object['oae:collection'][1]['oae:profilePath'])}
            {/if}
        {else}
            {var object1Obj = activity.object}
        {/if}
        {var object1 = oae.api.util.security().encodeForHTML(object1Obj.displayName)}
        {var object1URL = oae.api.util.security().encodeForHTML(object1Obj['oae:profilePath'])}

        {if activity.target}
            {if activity.target['oae:collection']}
                {var target1Obj = activity.target['oae:collection'][0]}
                {if activity.target['oae:collection'].length > 1}
                    {var targetCount = activity.target['oae:collection'].length}
                    {var target2 = oae.api.util.security().encodeForHTML(activity.target['oae:collection'][1].displayName)}
                    {var target2URL = oae.api.util.security().encodeForHTML(activity.target['oae:collection'][1]['oae:profilePath'])}
                {/if}
            {else}
                {var target1Obj = activity.target}
            {/if}
            {var target1 = oae.api.util.security().encodeForHTML(target1Obj.displayName)}
            {var target1URL = oae.api.util.security().encodeForHTML(target1Obj['oae:profilePath'])}
        {/if}

        <div class="activity-summary-container clearfix">
            <div class="pull-left activity-summary-thumbnail">
                ${renderThumbnail(actor1Obj)}
            </div>
            <div class="activity-summary oae-threedots">
                {var activityType = activity['oae:activityType']}
                {if activityType === 'content-comment'}
                    ${renderContentCommentSummary(activity, actor1, actor1URL, actor2, actor2URL, actorCount, target1, target1URL)}
                {elseif activityType === 'content-create'}
                    ${renderContentCreateSummary(activity, actor1, actor1URL, object1, object1URL, object2, object2URL, objectCount)}
                {elseif activityType === 'content-share'}
                    ${renderContentShareSummary(activity, actor1, actor1URL, object1, object1URL, target1, target1URL, target2, target2URL, targetCount)}
                {elseif activityType === 'content-update' || activityType === 'content-revision'}
                    CONTENT-UPDATE
                {elseif activityType === 'content-update-visibility'}
                    CONTENT-UPDATE-VISIBILITY
                {elseif activityType === 'group-add-member'}
                    GROUP-ADD-MEMBER
                {elseif activityType === 'group-create'}
                    GROUP-CREATE
                {elseif activityType === 'group-update'}
                    GROUP-UPDATE
                {elseif activityType === 'group-update-visibility'}
                    GROUP-UPDATE-VISIBILITY
                {/if}
            </div>
            <small>${jQuery.timeago(new Date(activity.published))}</small>
        </div>
    {/macro}

    {macro renderContentCommentSummary(activity, actor1, actor1URL, actor2, actor2URL, actorCount, object1, object1URL)}
        {if activity.target['oae:resourceSubType'] === 'collabdoc'}
            {if !actorCount}
                __MSG__CONTENT_COMMENT_COLLABDOC_1__
            {elseif actorCount === 2}
                __MSG__CONTENT_COMMENT_COLLABDOC_2__
            {else}
                __MSG__CONTENT_COMMENT_COLLABDOC_2+__
            {/if}
        {elseif activity.target['oae:resourceSubType'] === 'file'}
            {if !actorCount}
                __MSG__CONTENT_COMMENT_FILE_1__
            {elseif actorCount === 2}
                __MSG__CONTENT_COMMENT_FILE_2__
            {else}
                __MSG__CONTENT_COMMENT_FILE_2+__
            {/if}
        {elseif activity.target['oae:resourceSubType'] === 'link'}
            {if !actorCount}
                __MSG__CONTENT_COMMENT_LINK_1__
            {elseif actorCount === 2}
                __MSG__CONTENT_COMMENT_LINK_2__
            {else}
                __MSG__CONTENT_COMMENT_LINK_2+__
            {/if}
        {/if}
    {/macro}

    {macro renderContentCreateSummary(activity, actor1, actor1URL, object1, object1URL, object2, object2URL, objectCount)}
        {if !objectCount}
            {if activity.object['oae:resourceSubType'] === 'collabdoc'}
                __MSG__CONTENT_CREATE_COLLABDOC__
            {elseif activity.object['oae:resourceSubType'] === 'file'}
                __MSG__CONTENT_CREATE_FILE__
            {elseif activity.object['oae:resourceSubType'] === 'link'}
                __MSG__CONTENT_CREATE_LINK__
            {/if}
        {elseif objectCount === 2}
            __MSG__CONTENT_CREATE_2__
        {else}
            __MSG__CONTENT_CREATE_2+__
        {/if}
    {/macro}

    {macro renderContentShareSummary(activity, actor1, actor1URL, object1, object1URL, target1, target1URL, target2, target2URL, targetCount)}
        {if activity.object['oae:resourceSubType'] === 'collabdoc'}
            {if !targetCount}
                __MSG__CONTENT_SHARE_COLLABDOC_1__
            {elseif targetCount === 2}
                __MSG__CONTENT_SHARE_COLLABDOC_2__
            {else}
                __MSG__CONTENT_SHARE_COLLABDOC_2+__
            {/if}
        {elseif activity.object['oae:resourceSubType'] === 'file'}
            {if !targetCount}
                __MSG__CONTENT_SHARE_FILE_1__
            {elseif targetCount === 2}
                __MSG__CONTENT_SHARE_FILE_2__
            {else}
                __MSG__CONTENT_SHARE_FILE_2+__
            {/if}
        {elseif activity.object['oae:resourceSubType'] === 'link'}
            {if !targetCount}
                __MSG__CONTENT_SHARE_LINK_1__
            {elseif targetCount === 2}
                __MSG__CONTENT_SHARE_LINK_2__
            {else}
                __MSG__CONTENT_SHARE_LINK_2+__
            {/if}
        {/if}
    {/macro}


    {macro renderPreview(activity)}
        <div class="activity-preview-container clearfix">
            {var previewObj = activity.target || activity.object}
            {if previewObj['oae:wideImage']}
                <ul class="oae-list oae-list-grid activity-wide">
                    ${listItem(previewObj, null, null, false, previewObj['oae:wideImage'].url)}
                </ul>
            {else}
                {if previewObj['oae:collection']}
                    {var count = previewObj['oae:collection'].length}
                    {if count <= 3}
                        {var largePreviews = previewObj['oae:collection'].slice(0, 3)}
                    {else}
                        {var largePreviews = previewObj['oae:collection'].slice(0, 2)}
                        {var smallPreviews = previewObj['oae:collection'].slice(2, 14)}
                    {/if}
                {else}
                    {var largePreviews = [previewObj]}
                {/if}

                <ul class="oae-list oae-list-grid">
                    {for largePreview in largePreviews}
                        ${listItem(largePreview, null, null, false)}
                    {/for}
                    {if smallPreviews}
                        <li>
                            <div class="oae-tile activity-multiple">
                                {for smallPreview in smallPreviews}
                                    ${renderThumbnail(smallPreview, false)}
                                {/for}
                                {if count > 14}
                                    {var x = count - 14}
                                    <div class="oae-tile-metadata">__MSG__AND_X_MORE__</div>
                                {/if}
                            </div>
                        </li>
                    {/if}
                </ul>
            {/if}
        </div>
    {/macro}

    {macro renderComments(activity)}
        Comments
    {/macro}

    {for activity in results}
        <li data-key="${activity['oae:activityId']}">
            <div class="well">
                ${renderSummary(activity)}
                ${renderPreview(activity)}
                ${renderComments(activity)}
            </div>
        </li>
    {/for}
--></div>











<div><!--
    {macro renderCommentBox(actor, comment)}
        <div class="pull-left activity-entity-image">
            ${renderThumbnail(actor)}
        </div>
        {var created = comment['oae:commentThreadKey'].split('#').pop()}
        <div class="media-body">
            <h4 class="media-heading">
                {if actor.url}
                    <a href="${actor.url}">
                        ${actor.displayName|encodeForHTML}
                    </a>
                {else}
                    ${actor.displayName|encodeForHTML}
                {/if}
                <span>
                    ${jQuery.timeago(new Date(parseInt(created.substring(0, created.length - 1))))}
                </span>
            </h4>
            ${comment.content|encodeForHTML}
        </div>
    {/macro}
    
    {macro renderCommentActivity(activity)}
        {var mainActor = activity.actor}
        {if activity.actor['oae:collection']}
            {var mainActor = activity.actor['oae:collection'][0]}
        {/if}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(mainActor)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                    {if mainActor.url}
                        <a href="${mainActor.url}">${mainActor.displayName|encodeForHTML}</a>
                    {else}
                        ${mainActor.displayName|encodeForHTML}
                    {/if}
                    {if activity.actor['oae:collection']}
                        <span> and ${activity.actor['oae:collection'].length - 1} {if (activity.actor['oae:collection'].length - 1) === 1} __MSG__OTHER__{else} __MSG__OTHERS__{/if} __MSG__COMMENTED_ON__</span> <a href="${activity.target.url}">${activity.target.displayName|encodeForHTML}</a> 
                    {else}
                        <span>__MSG__COMMENTED_ON__</span> <a href="${activity.target.url}">${activity.target.displayName|encodeForHTML}</a>
                    {/if}
                </div>
                <div class="activity-timeago">${jQuery.timeago(new Date(activity.published))}</div>
            </div>
        </div>
    {/macro}

    {macro renderShareActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.object)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                    {if activity.object['oae:collection']}
                        {if activity.actor.url}
                            <a href="${activity.actor.url}">${activity.actor.displayName|encodeForHTML}</a>
                        {else}
                            ${activity.actor.displayName|encodeForHTML}
                        {/if}
                        <span> shared the PDF</span> <a href="${activity.object['oae:collection'][0].url}" title="${activity.object['oae:collection'][0].displayName|encodeForHTMLAttribute}">${activity.object['oae:collection'][0].displayName|encodeForHTML}</a> and ${activity.object['oae:collection'].length - 1} {if (activity.object['oae:collection'].length - 1) === 1} __MSG__OTHER__{else} __MSG__OTHERS__{/if}
                    {else}
                        {if activity.actor.url}
                            <a href="${activity.actor.url}">${activity.actor.displayName|encodeForHTML}</a>
                        {else}
                            ${activity.actor.displayName|encodeForHTML}
                        {/if}
                        <span> shared the PDF</span> <a href="${activity.object.url}" title="${activity.object.displayName|encodeForHTMLAttribute}">${activity.object.displayName|encodeForHTML}</a>
                    {/if}
                </div>
                {if activity.target['oae:collection']}
                    <div class="activity-timeago">__MSG__WITH__
                        {if activity.target['oae:collection'][0].url}
                            <a href="${activity.target['oae:collection'][0].url}">${activity.target['oae:collection'][0].displayName|encodeForHTML}</a>
                        {else}
                            ${activity.target['oae:collection'][0].displayName|encodeForHTML}
                        {/if}
                        and ${activity.target['oae:collection'].length - 1} {if (activity.target['oae:collection'].length - 1) === 1} __MSG__OTHER__{else} __MSG__OTHERS__{/if} ${jQuery.timeago(new Date(activity.published))}</div>
                {else}
                    <div class="activity-timeago">__MSG__WITH__
                    {if activity.target.url}
                        <a href="${activity.target.url}">${activity.target.displayName|encodeForHTML}</a>
                    {else}
                        ${activity.target.displayName|encodeForHTML}
                    {/if}
                    ${jQuery.timeago(new Date(activity.published))}</div>
                {/if}
            </div>
        </div>
    {/macro}

    {macro renderCreateContentActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor, false, false)}
                </div>
                <div class="activity-entity-name oae-threedots oae-bold">
                {if activity.actor.url}
                    <a href="${activity.actor.url}">${activity.actor.displayName|encodeForHTML}</a>
                {else}
                    ${activity.actor.displayName|encodeForHTML}
                {/if}
                <span>__MSG__CREATED__</span> <a href="${activity.object.url}">${activity.object.displayName|encodeForHTML}</a>

                {if activity.object['oae:collection']}
                    ${activity.object['oae:collection'].length} __MSG__CONTENT_ITEMS__
                {/if}
                </div>
                <div class="activity-timeago">${jQuery.timeago(new Date(activity.published))}</div>
            </div>
        </div>
    {/macro}

    {macro renderLargeContentPreview(actor, content, comments)}
        <div class="activity-comment-container">
            {if comments && comments['oae:collection']}
                <ul class="media-list">
                    {for c in comments['oae:collection']}
                        <li class="media {if c['oae:replyTo']} activity-reply{/if}">
                            {var commentActor = actor}
                            {if actor['oae:collection']}
                                {for a in actor['oae:collection']}
                                    {if a['oae:id'] === c.author['oae:id']}
                                        {var commentActor = a}
                                    {/if}
                                {/for}
                            {/if}
                            ${renderCommentBox(c.author, c)}
                        </li>
                    {/for}
                </ul>
                <a href="${content.url}" title="${content.displayName|encodeForHTMLAttribute}" class="oae-bold activity-read-more text-center">__MSG__SHOW_MORE__...</a>
            {elseif comments}
                <ul class="media-list">
                    <li class="media">
                        ${renderCommentBox(comments.author, comments)}
                        <a href="${content.url}" title="${content.displayName|encodeForHTMLAttribute}" class="oae-bold activity-read-more text-center">__MSG__SHOW_MORE__...</a>
                    </li>
                </ul>
            {/if}
        </div>
    {/macro}

    {macro renderVisibilityUpdateActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                {if activity.actor.url}
                    <a href="${activity.actor.url}">${activity.actor.displayName|encodeForHTML}</a>
                {else}
                    ${activity.actor.displayName|encodeForHTML}
                {/if}
                    <span>
                        {if activity['oae:activityType'] === 'group-update'}
                            __MSG__UPDATED_GROUP__
                        {elseif activity['oae:activityType'] === 'content-update-visibility'}
                            __MSG__UPDATED_CONTENT_VISIBILITY__
                        {elseif activity['oae:activityType'] === 'group-update-visibility'}
                            __MSG__UPDATED_GROUP_VISIBILITY__
                        {/if}
                    </span>
                </div>
                <div class="activity-timeago">${jQuery.timeago(new Date(activity.published))}</div>
            </div>
        </div>
    {/macro}

    {macro renderContentUpdate(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                {if activity.actor.url}
                    <a href="${activity.actor.url}" title="${activity.actor.displayName|encodeForHTMLAttribute}">${activity.actor.displayName|encodeForHTML}</a>
                {else}
                    ${activity.actor.displayName|encodeForHTML}
                {/if}
                <span>__MSG__UPDATED_CONTENT__</span> <a href="${activity.object.url}">${activity.object.displayName|encodeForHTML}</a>

                {if activity.object['oae:collection']}
                    ${activity.object['oae:collection'].length} __MSG__CONTENT_ITEMS__
                {/if}
                </div>
                <div class="activity_timeago">${jQuery.timeago(new Date(activity.published))}</div>
            </div>
        </div>
    {/macro}

    {macro renderCreateGroupActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.object)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                    {if activity.actor.url}
                        <a href="${activity.actor.url}">${activity.actor.displayName|encodeForHTML}</a>
                    {else}
                        ${activity.actor.displayName|encodeForHTML}
                    {/if}
                    <span>__MSG__CREATED_THE_GROUP__</span> <a href="${activity.object.url}">${activity.object.displayName|encodeForHTML}</a>
                </div>
                <div class="activity-timeago">${jQuery.timeago(new Date(activity.published))}</div>
            </div>
        </div>
    {/macro}

    {macro renderAddMemberActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.target)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                    {if activity.actor.url}
                        <a href="${activity.actor.url}">${activity.actor.displayName|encodeForHTML}</a>
                    {else}
                        ${activity.actor.displayName|encodeForHTML}
                    {/if}
                        <span>__MSG__ADDED__</span>
                    {if activity.object['oae:collection']}
                        {if activity.object['oae:collection'][0].url}
                            <a href="${activity.object['oae:collection'][0].url}">${activity.object['oae:collection'][0].displayName|encodeForHTML}</a>
                        {else}
                            ${activity.object['oae:collection'][0].displayName|encodeForHTML}
                        {/if}
                        <span>__MSG__AND_LOWERCASE__ ${activity.object['oae:collection'].length - 1} {if activity.object['oae:collection'].length === 1} __MSG__OTHER__{else} __MSG__OTHERS__{/if}</span>
                    {else}
                        {if activity.object.url}
                            <a href="${activity.object.url}">${activity.object.displayName|encodeForHTML}</a>
                        {else}
                            ${activity.object.displayName|encodeForHTML}
                        {/if}
                    {/if}
                    <span>__MSG__TO_THE_GROUP__</span> <a href="${activity.target.url}">${activity.target.displayName|encodeForHTML}</a>
                </div>
                <div class="activity-timeago">${jQuery.timeago(new Date(activity.published))}</div>
            </div>
        </div>
    {/macro}

    {for activity in results}
        <li data-key="${activity['oae:activityId']}">
            {if activity['oae:activityType'] === 'content-comment'}
                ${renderCommentActivity(activity)}
            {elseif activity['oae:activityType'] === 'content-share'}
                ${renderShareActivity(activity)}
            {elseif activity['oae:activityType'] === 'content-create'}
                ${renderCreateContentActivity(activity)}
            {elseif activity['oae:activityType'] === 'content-update-visibility' ||
                    activity['oae:activityType'] === 'group-update-visibility' ||
                    activity['oae:activityType'] === 'group-update'}
                ${renderVisibilityUpdateActivity(activity)}
            {elseif activity['oae:activityType'] === 'content-update' ||
                    activity['oae:activityType'] === 'content-revision'}
                ${renderContentUpdate(activity)}
            {elseif activity['oae:activityType'] === 'group-create'}
                ${renderCreateGroupActivity(activity)}
            {elseif activity['oae:activityType'] === 'group-add-member'}
                ${renderAddMemberActivity(activity)}
            {/if}
        </li>
    {/for}
--></div>

<!-- JAVASCRIPT -->
<script type="text/javascript" src="js/activity.js"></script>
